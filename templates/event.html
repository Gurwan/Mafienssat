{% extends 'main.html' %}
{% block content %}
{% load static %}
{% include 'nav.html' %}
<div class="container">
    {% for event in events %}
        <div id="next-event">
            <img class="img-fluid" src="{% static 'img/background.jpg' %}"/>
            <h2 id="name">{{event.event_name}}</h2>
            <h3 id="date">{{event.event_date.ctime}}</h3>
            <div>
                <h4>{{event.event_type.title}}</h4> <br> <!-- TODO faire en sorte de pouvoir afficher le nom de l'event et pas l'acronyme -->
                {% if event.max_attendees != 0 %}
                    <h4>{{event.attendees_number}} inscrits sur {{event.max_attendees}} places disponibles</h4>
                {% endif %}
            </div>
        
            <p>{{event.event_description}}</p>
            
        </div>
        <div class="container-fluid" id="choices">
            <div id="main_col_event">
                <div class="row">
                    {% if user %}
                        {% if event.attendees_number < event.max_attendees and event.max_attendees != 0 %} <!-- TODO faire en sorte qu'une fois que l'utilisateur à cliqué une fois il ne puisse qu'annuler sa participation -->
                            <div class="col" id="event-{{ event.id }}" onclick="goEvent(this.id)">
                                <h2>Participer à l'événement</h2>
                            </div>
                        {% endif %}
                        {% if event.associated_bet %}
                            <div class="col" id="bet" onclick="goBet()">
                                <h2>Parier sur l'événement</h2>
                            </div>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
    {% endfor %}

    <script>
        function goEvent(id){

            const formData = new FormData();
            formData.append('csrfmiddlewaretoken', "{{ csrf_token }}");
            formData.append('event', id.split("-")[1]);
            fetch('{% url "eventRegistration" %}', {
                        method: 'POST',
                        body: formData
                    })
        }

    </script>
</div>
{% endblock %}