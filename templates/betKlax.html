{% extends 'main.html' %}
{% block content %}
{% load static %}
{% load bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}
{% include 'nav.html' %}
<div class="container">
  <div>
    <img src="{% static "betklax_logo.png" %}" alt="Logo">
  </div>

  <h1 style="text-align: center; margin-top:20px">Tous les paris</h1>
    <div class="container">
        {%  for bet in bets %}
            <div>
                <small>{{ bet.bet_name }}</small>
                <small onload="displayMonth({{ bet.ended.date }})"></small> <small>: Fini le {{ bet.ended.date.day }} {{ bet.ended.date.year }} à {{ bet.ended.hour }}:{{ bet.ended.minute }}</small>
                {% if request.user.is_authenticated %}
                    <button class="btn btn--main" type="submit" id="w-{{ bet.id }}" onclick="makeBet(this.id)" value="makeBetW" name="makeBetW">{{ bet.win_rate }}</button>
                    <br>
                    <button class="btn btn--main" type="submit" id="l-{{ bet.id }}" onclick="makeBet(this.id)" value="makeBetL" name="makeBetL">{{ bet.lose_rate }}</button>
                    <br>
                    <label for="mise"></label><input type="number" id="mise">
                {% else %}
                    <small> <br>Victoire: {{ bet.win_rate }} <br></small>
                    <small> Défaite: {{ bet.lose_rate }} <br></small>
                {% endif %}
            </div>
        {% endfor %}
    </div>
    <script>
        const monthNames = ["Janvier", "Février", "Mars", "Avril", "Mai", "Juin",
            "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"
        ];

        displayMonth = function(month_nb){
            document.write(monthNames[month_nb.getMonth() - 1]);
        }
        function makeBet(id){
            let gains = document.getElementById("mise").value;
            const formData = new FormData();
            formData.append('csrfmiddlewaretoken', "{{ csrf_token }}");
            formData.append('gains', gains);
            formData.append('bet',id.split("-")[1]);
            if(gains > 0){
                if(id.split("-")[0] === "w"){
                    fetch('{% url "makeBetW" %}', {
                        method: 'POST',
                        body: formData
                    })
                } else {
                    fetch('{% url "makeBetL" %}', {
                        method: 'POST',
                        body: formData
                    })
                }
            }
        }
    </script>
</div>
{% endblock %}